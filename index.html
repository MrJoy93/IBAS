<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IBASD Î²ç‰ˆ</title>
<style>

  body {
    background: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    font-size: 20px;
    margin: 0 auto;
    padding: 0;
    box-sizing: border-box;
}
  
  /* ã‚¿ãƒ–éƒ¨åˆ† */
  .tabs {
    display: flex;
    background: #222;
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid #444;
    width: 100vw; /* ç”»é¢å¹…ã„ã£ã±ã„ */
    max-width: 1400px; /* å¥½ããªæœ€å¤§å¹… */
    margin: 0 auto; /* ä¸­å¤®å¯„ã› */
  }
  .tab {
    flex: 1;
    padding: 12px 0;
    text-align: center;
    color: #bbb;
    cursor: pointer;
    user-select: none;
    border-bottom: 3px solid transparent;
    transition: background-color 0.3s, border-bottom-color 0.3s, color 0.3s;
  }
  .tab:hover {
    background-color: #333;
  }
  .tab.active {
    background-color: #111;
    border-bottom-color: #00aaff;
    color: #00aaff;
    font-weight: bold;
  }

  /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ† */
.content {
  background: #181818;
  color: #ddd;
  padding: 16px;
  min-height: 300px;
  width: 100vw; /* ç”»é¢å¹…ã„ã£ã±ã„ */
  max-width: 1400px; /* å¥½ããªæœ€å¤§å¹… */
  margin: 0 auto; /* ä¸­å¤®å¯„ã› */
  box-sizing: border-box;
}
  /* ã‚¹ãƒãƒ›å¯¾å¿œ */
  @media (max-width: 600px) {
    .tab {
      padding: 10px 6px;
      font-size: 14px;
    }
  }

</style>
</head>
<body>


  
<div class="tabs">
  <div class="tab active" data-target="app1">ä¼ç¥¨å…¥åŠ›</div>
  <div class="tab" data-target="app2">å ±é…¬è¨ˆç®—</div>
  <div class="tab" data-target="app3">æ—¥è¨ˆè¨ˆç®—</div>
</div>





<div id="app1" class="content">

    <style>

    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }

    th, td {
      border: 1px solid #444;
      padding: 6px;
      text-align: center;
    }

    input, select {
      box-sizing: border-box;
      padding: 6px;
      background-color: #333;
      color: #fff;
      border: 1px solid #555;
    }

    .row {
      background-color: #2c2c2c;
    }

    .totals {
      font-weight: bold;
      background-color: #444;
    }

    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      tr {
        margin-bottom: 10px;
        border-bottom: 2px solid #444;
      }
      td {
        text-align: right;
        position: relative;
        padding-left: 50%;
      }
      td::before {
        content: attr(data-label);
        position: absolute;
        left: 10px;
        font-weight: bold;
        text-align: left;
      }
    }

    .category-UK { background-color: #00796b; }
    .category-K  { background-color: #d81b60; }
    .category-AB { background-color: #388e3c; }
    .category-LA { background-color: #ff7043; }
    .category-PA { background-color: #7e57c2; }
    .category-BB { background-color: #8e24aa; }
    .category-MS { background-color: #29b6f6; }
    .category-GM { background-color: #ffca28; }
    .category-B  { background-color: #ffab91; }
    .category-JOE { background-color: #c5e1a5; }
    .category-KOSE { background-color: #a1887f; }
    .category-HE { background-color: #80deea; }
    .category-PB { background-color: #f0f4c3; }
    .category-X  { background-color: #bdbdbd; }
    .category-Z  { background-color: #ff69b4; }

    .tab {
      margin: 10px 0;
      overflow-x: auto;
    }

    .tab button {
      padding: 10px;
      margin-right: 5px;
      cursor: pointer;
      background-color: #333;
      color: #fff;
      border: 1px solid #444;
    }

    .tab button.active {
      background-color: #444;
    }

    h3 {
      font-size: 16px;
    }

    label {
      display: none;
    }
  </style>
 
<div class="tab">
  <button class="tablinks" onclick="filterCategory('all')">ã™ã¹ã¦è¡¨ç¤º</button>
  <button class="tablinks" onclick="filterCashOnlyRows()">ç¾é‡‘ã®ã¿æŠ½å‡º</button>
  <button class="tablinks" onclick="filterCardInputRows()">ã‚«ãƒ¼ãƒ‰æŠ½å‡º</button>
  <button class="tablinks" onclick="filterCategory('UK')">UK</button>
  <button class="tablinks" onclick="filterCategory('K')">K</button>
  <button class="tablinks" onclick="filterCategory('AB')">AB</button>
  <button class="tablinks" onclick="filterCategory('LA')">LA</button>
  <button class="tablinks" onclick="filterCategory('PA')">PA</button>
  <button class="tablinks" onclick="filterCategory('BB')">BB</button>
  <button class="tablinks" onclick="filterCategory('MS')">MS</button>
  <button class="tablinks" onclick="filterCategory('GM')">GM</button>
  <button class="tablinks" onclick="filterCategory('B')">B</button>
  <button class="tablinks" onclick="filterCategory('JOE')">JOE</button>
  <button class="tablinks" onclick="filterCategory('KOSE')">KOSE</button>
  <button class="tablinks" onclick="filterCategory('HE')">HE</button>
  <button class="tablinks" onclick="filterCategory('PB')">PB</button>
  <button class="tablinks" onclick="filterCategory('X')">X</button>
  <button class="tablinks" onclick="filterCategory('Z')">Z</button>
</div>

<table>
  <tbody id="formRows">
    <tr class="row">
      <td class="rowNumber">1</td>
      <td><input class="table-number" type="number" placeholder="å“ç•ª" onchange="updateTotals()" /></td>
      <td><input class="honshi" type="number" placeholder="æœ¬æŒ‡" onchange="updateTotals()" /></td>
      <td>
        <select class="c" onchange="updateRowColor(this); updateTotals()">
          <option value="">-</option>
          <option value="UK">UK</option>
          <option value="K">K</option>
          <option value="AB">AB</option>
          <option value="LA">LA</option>
          <option value="PA">PA</option>
          <option value="BB">BB</option>
          <option value="MS">MS</option>
          <option value="GM">GM</option>
          <option value="B">B</option>
          <option value="JOE">JOE</option>
          <option value="KOSE">KOSE</option>
          <option value="HE">HE</option>
          <option value="PB">PB</option>
          <option value="X">X</option>
          <option value="Z">Z</option>
        </select>
      </td>
      <td><input class="amount" type="number" placeholder="é‡‘é¡" onchange="updateTotals()" /></td>
      <td><input class="num" type="number" placeholder="äººæ•°" onchange="updateTotals()" /></td>
      <td><input class="detail" type="text" placeholder="è©³ç´°" /></td>
      <td><input class="card" type="number" placeholder="ã‚«ãƒ¼ãƒ‰" onchange="updateTotals()" /></td>
      <td><input class="total" type="number" placeholder="ç·åˆè¨ˆ" onchange="updateTotals()" /></td>
    </tr>
  </tbody>
</table>

<button onclick="addRow()" style="font-size: 18px; padding: 15px 30px;">ä¼ç¥¨ã‚’è¿½åŠ </button>

<h3>é›†è¨ˆ</h3>
<p>ç·å®¢æ•°: <span id="totalCustomers">0</span></p>
<p>ç¾é‡‘åˆè¨ˆ: <span id="cashTotal">0</span></p>
<p>ã‚«ãƒ¼ãƒ‰åˆè¨ˆ: <span id="cardTotal">0</span></p>
<p>ç·åˆè¨ˆé‡‘é¡: <span id="totalAmount">0</span></p>

<h3>ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚­ãƒ£ãƒƒãƒãƒãƒƒã‚¯</h3>
<table>
  <thead>
    <tr>
      <th>ã‚«ãƒ†ã‚´ãƒª</th>
      <th>äººæ•°</th>
      <th>ãƒãƒƒã‚¯é‡‘é¡</th>
    </tr>
  </thead>
  <tbody>
    <tr><td><input type="checkbox"> UK</td><td id="UKcount">0</td><td id="UKtotal">0</td></tr>
    <tr><td><input type="checkbox"> K</td><td id="Kcount">0</td><td id="Ktotal">0</td></tr>
    <tr><td><input type="checkbox"> AB</td><td id="ABcount">0</td><td id="ABtotal">0</td></tr>
    <tr><td><input type="checkbox"> LA</td><td id="LAcount">0</td><td id="LAtotal">0</td></tr>
    <tr><td><input type="checkbox"> PA</td><td id="PAcount">0</td><td id="PAtotal">0</td></tr>
    <tr><td><input type="checkbox"> BB</td><td id="BBcount">0</td><td id="BBtotal">0</td></tr>
    <tr><td><input type="checkbox"> MS</td><td id="MScount">0</td><td id="MStotal">0</td></tr>
    <tr><td><input type="checkbox"> GM</td><td id="GMcount">0</td><td id="GMtotal">0</td></tr>
    <tr><td><input type="checkbox"> B</td><td id="Bcount">0</td><td id="Btotal">0</td></tr>
    <tr><td><input type="checkbox"> JOE</td><td id="JOEcount">0</td><td id="JOEtotal">0</td></tr>
    <tr><td><input type="checkbox"> KOSE</td><td id="KOSEcount">0</td><td id="KOSEtotal">0</td></tr>
    <tr><td><input type="checkbox"> HE</td><td id="HEcount">0</td><td id="HEtotal">0</td></tr>
    <tr><td><input type="checkbox"> PB</td><td id="PBcount">0</td><td id="PBtotal">0</td></tr>
    <tr><td><input type="checkbox"> X</td><td id="Xcount">0</td><td id="Xtotal">0</td></tr>
    <tr style="display: none;"><td><input type="checkbox"> Z</td><td id="Zcount">0</td><td id="Ztotal">0</td></tr>
    <tr>
      <td><strong>åˆè¨ˆ</strong></td>
      <td id="totalCount">0</td>
      <td id="totalBackAmount">0</td>
    </tr>
  </tbody>
</table>

<div style="text-align: center; margin-top: 30px;">
  <button onclick="resetAll()" style="color: red; background: transparent; border: 2px solid red; padding: 10px 20px; font-size: 16px; cursor: pointer;">
    ãƒªã‚»ãƒƒãƒˆ
  </button>
</div>

</div>


<div id="app2" class="content" style="display:none;">

<style>

  @media (prefers-color-scheme: dark) {
    body {
      background: #121212;
      color: #ffffff;
    }
  }

  h2, h3 {
    text-align: center;
  }

  label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 10px 0;
    font-size: 16px;
  }

  input[type="number"], input[type="text"] {
    width: 150px;
    padding: 10px;
    border: none;
    border-radius: 4px;
  }

  button {
    flex: 1;
    padding: 12px;
    font-size: 18px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  button:hover {
    background: #45a049;
  }

  /* === å„ã‚°ãƒ«ãƒ¼ãƒ—ã®èƒŒæ™¯è‰² === */
.group {
  padding: 15px;
  margin: 15px 0;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.group-basic   { background: #1e3a5f; }
.group-shimei  { background: #5f1e3a; }
.group-set     { background: #1e5f3a; }
.group-option  { background: #5f4e1e; }

  /* === çµæœè¡¨ç¤º === */
  .result {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
    box-shadow: 0 0 10px rgba(255,255,255,0.05);
    font-size: 22px;
  }

  .result span {
    display: block;
    margin-bottom: 5px;
    padding: 5px;
    border-radius: 4px;
  }

  .subtotal { background-color: #1e3a5f; }
  .totalAmount      { background-color: #5f1e3a; }
  .finalAmount  { background-color: #5f4e1e; }

  /* === å±¥æ­´ === */
  .history {
    margin-top: 30px;
  }

  .history li {
    margin-bottom: 8px;
  }

  /* === ãƒœã‚¿ãƒ³åˆ— === */
  .button-row {
    display: flex;
    gap: 10px;
    margin-top: 20px;
  }

  .summary {
    font-weight: bold;
    margin-top: 20px;
  }

  /* === ãƒœã‚¿ãƒ³ã‚«ãƒ©ãƒ¼å€‹åˆ¥æŒ‡å®š === */
  .clear-button {
    background: #e53935;
  }

  .clear-button:hover {
    background: #c62828;
  }

  .clear-all-button {
    width: 100%;
    padding: 15px;
    font-size: 18px;
    background: #e53935;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  .clear-all-button:hover {
    background: #c62828;
  }

  .print-button {
    width: 100%;
    padding: 15px;
    font-size: 18px;
    background: #2196F3;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  .print-button:hover {
    background: #1976D2;
  }

/* === ãƒœãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆé€šå¸¸ï¼‰ === */
.bottle-entry,
.bottle-form {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 5px;
  width: 100%;  /* â† 120%ã‹ã‚‰ä¿®æ­£ */
}

.bottle-label {
  min-width: 100px;
  text-align: left;
}

.bottle-entry input[type="text"],
.bottle-entry input[type="number"],
.bottle-form input[type="text"],
.bottle-form input[type="number"] {
  width: 200px;  /* â† 150pxã‹ã‚‰ä¿®æ­£ */
  padding: 6px;
  font-size: 16px;
  border-radius: 4px;
  border: 1px solid #ccc;
}

.bottle-form {
  justify-content: flex-end;
}

.bottle-form label {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

@media print {
  @page {
    size: 90mm 205mm;
    margin: 2mm; /* æœ€å°é™ã®ä½™ç™½ */
  }

  body {
    all: unset;
    margin: 0;
    padding: 0;
    width: 90mm;
    height: 205mm;
    font-size: 8pt !important;
    line-height: 1.1 !important;
    background: #fff !important;
    color: #000 !important;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  * {
    background: transparent !important;
    color: #000 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  .group-basic,
  .group-shimei,
  .group-set,
  .group-option,
  .result,
  .subtotal,
  .totalAmount,
  .finalAmount {
    background: transparent !important;
  }

  body * {
    visibility: hidden;
  }

  #result,
  #result * {
    visibility: visible;
  }

  #result {
    position: absolute;
    top: 2mm;
    left: 2mm;
    width: calc(90mm - 4mm);
    height: calc(205mm - 4mm);
    box-sizing: border-box;
    transform-origin: center center;
    transform: rotate(180deg) scale(0.97);
    background: transparent !important;
    color: #000 !important;
    white-space: normal !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    font-size: 8pt !important;
    line-height: 1.1 !important;
  }

  .button-row,
  .clear-button,
  .clear-all-button,
  .print-button,
  form,
  .history,
  .summary {
    display: none !important;
  }

  details {
    display: block !important;
  }

  details summary {
    display: none !important;
  }

  details[open] summary::after,
  details:not([open]) summary::after {
    content: "";
  }

  .print-only {
    display: inline !important;
  }

  /* âœ… æ°åã‚¨ãƒªã‚¢ã®æ–‡å­—ã‚µã‚¤ã‚ºæ‹¡å¤§ */
  .group-shimei {
    font-size: 10pt !important;
  }

  /* âœ… æœ€çµ‚åˆè¨ˆã‚’å¼·èª¿ï¼ˆé’ãƒ»å¤§ãã‚ï¼‰ */
  .finalAmount.print-highlight {
    font-weight: bold !important;
    color: rgb(90, 57, 251) !important;
    font-size: 11pt !important;
  }

  /* âœ… åˆè¨ˆé‡‘é¡ã‚’ã‚ªãƒ¬ãƒ³ã‚¸ãƒ»é€šå¸¸ã‚µã‚¤ã‚º */
  .totalAmount {
    color: orange !important;
    font-weight: bold !important;
    font-size: 8pt !important;
  }

  /* âœ… å°è¨ˆã‚‚ã‚µã‚¤ã‚ºåˆã‚ã› */
  .subtotal {
    font-size: 8pt !important;
  }

  /* âœ… æ”¹ãƒšãƒ¼ã‚¸ç”¨ã‚¯ãƒ©ã‚¹ */
  .page-break {
    page-break-before: always;
  }
}

























</style> 

  <div class="button-row" style="margin-top: 10px; justify-content: center;">
  <button type="button" class="clear-button" onclick="clearInputs()">å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
</div>

<form onsubmit="event.preventDefault(); calculate();">
  <div class="group" style="background:#2e2e2e">
    <label>ã‚­ãƒ£ã‚¹ãƒˆå: <input type="text" id="castName" placeholder="åå‰ã‚’å…¥åŠ›"></label>
    <label>ä½“é¨“åŠã³è²¸å‡º:<input type="checkbox" id="experienceAndRental"></label>
    <!--<label>ä¿éšœ: <input type="number" id="guaranteeAmount" placeholder="ä¿éšœé‡‘é¡"></label>-->
    <label>é€è¿: <input type="number" id="sendoffAmount" placeholder="é€è¿é‡‘é¡"></label>
  </div>

    <div class="group group-basic">
      <h3>ãƒ•ãƒªãƒ¼ãƒãƒƒã‚¯</h3>
      <label>F1ï¼ˆÂ¥1500ï¼‰: <input type="number" id="f" placeholder="F1"></label>
      <label>F2ï¼ˆÂ¥2000ï¼‰: <input type="number" id="f2" placeholder="F2"></label>
      <label>å ´å†…ï¼ˆÂ¥1000ï¼‰: <input type="number" id="jounai" placeholder="å ´å†…"></label>
    </div>

    <div class="group group-shimei">
      <h3>æŒ‡åãƒ»åŒä¼´ãƒ»æãƒ»HELP</h3>
      <label>æœ¬æŒ‡ï¼ˆÂ¥0ï¼‰: <input type="number" id="honshiri" placeholder="æœ¬æŒ‡"></label>
      <label>åŒä¼´ï¼ˆÂ¥1500ï¼‰: <input type="number" id="douhan" placeholder="åŒä¼´"></label>
      <label>æï¼ˆÂ¥500ï¼‰: <input type="number" id="eda" placeholder="æ"></label>
      <label>HELPï¼ˆ-Â¥1500ï¼‰: <input type="number" id="help" placeholder="HELP"></label>
    </div>

    <div class="group group-set">
      <h3>ã‚»ãƒƒãƒˆãƒ»VIP</h3>
      <label>SET40ï¼ˆÂ¥5500ï¼‰: <input type="number" id="set40" placeholder="SET40"></label>
      <label>SET20ï¼ˆÂ¥3500ï¼‰: <input type="number" id="set20" placeholder="SET20"></label>
      <label>VIPï¼ˆÂ¥2000ï¼‰: <input type="number" id="vip" placeholder="VIP"></label>
    </div>

    <div class="group group-option">
      <h3>ãƒ‰ãƒªãƒ³ã‚¯ãƒ»ãã®ä»–</h3>
      <label>Aï¼ˆÂ¥500ï¼‰: <input type="number" id="a" placeholder="A"></label>
      <label>Bï¼ˆÂ¥1000ï¼‰: <input type="number" id="b" placeholder="B"></label>
      <label>Cï¼ˆÂ¥1500ï¼‰: <input type="number" id="c" placeholder="C"></label>
      <label>Dï¼ˆÂ¥2000ï¼‰: <input type="number" id="d" placeholder="D"></label>
      <label>Eï¼ˆÂ¥2500ï¼‰: <input type="number" id="e" placeholder="E"></label>

      <div id="bottleFormsContainer"></div>
      <button type="button" onclick="addBottleForm()">ãƒœãƒˆãƒ«è¿½åŠ </button>
    </div>

    <!-- ã“ã“ã§formã®é–‰ã˜ã‚¿ã‚° -->
    <div class="button-row" style="margin-top: 20px;">
      <button type="submit">è¨ˆç®—ã™ã‚‹</button>
    </div>
  </form>

  <div class="result" id="result"></div>

  <div class="button-row" style="margin-top: 20px;">
    <button type="button" class="print-button" onclick="preparePrint()">å‡ºåŠ›</button>
  </div>

  <div class="button-row" style="margin-top: 20px;">
    <button type="button" class="clear-button" onclick="clearInputs()">å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
  </div>

  <div class="history">
    <h3>å±¥æ­´</h3>
    <ul id="historyList"></ul>
  </div>

  <button id="deleteSelectedBtn" onclick="deleteSelectedHistory()">é¸æŠã—ãŸå±¥æ­´ã‚’å‰Šé™¤</button>

  <div class="summary" id="summary">
  å±¥æ­´ã®åˆè¨ˆäººæ•°: <span id="summaryTotalPeople">0äºº</span> |
  åˆè¨ˆé‡‘é¡: <span id="summaryTotalAmount">Â¥0</span> |
  åˆè¨ˆæºæ³‰è²»: <span id="summaryTotalTax">Â¥0</span>
  </div>

  <div class="button-row" style="margin-top: 40px;">
    <button type="button" class="clear-all-button" onclick="clearAll()">å®Œå…¨ã‚¯ãƒªã‚¢</button>
  </div>

</div>




<div id="app3" class="content" style="display:none;">

  <style>
    
    .group {
      margin-bottom: 24px;
      padding: 16px;
      border-radius: 10px;
    }
    label {
      display: flex;
      flex-direction: column;
      margin-bottom: 12px;
    }
    label span {
      margin-bottom: 6px;
      font-size: 15px;
    }
    input[type="number"],
    input[type="text"],
    input[disabled] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      text-align: right;
      box-sizing: border-box;
    }
    input[disabled] {
      background-color: #444;
      color: #ddd;
    }
    #salesGroup { background-color: #2b3a3b; }
    #laborGroup { background-color: #3a4f5a; }
    #taxGroup { background-color: #4b4a5b; }
    #expensesGroup { background-color: #5c6b6c; }
    #resultsGroup {
      background-color: #3b4f3a;
      font-weight: bold;
      color: #b8f3b8;
    }
    .negative {
      color: red !important;
    }

    .no-bg {
      background-color: transparent !important;
    }

    .reset-button {
      display: block;
      width: 100%;
      background-color: #c0392b;
      color: white;
      font-size: 18px;
      padding: 12px;
      border: none;
      border-radius: 10px;
      margin-top: 30px;
      cursor: pointer;
    }

    @media (min-width: 600px) {
      label {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
      label span {
        margin-bottom: 0;
      }
      input[type="number"],
      input[type="text"],
      input[disabled] {
        max-width: 200px;
      }
    }

    .reset-button:hover {
  background-color: #ff0033;
}
  </style>

  <div class="group no-bg">
    <label><span>é–‹å§‹æ™‚é‡‘åº«é‡‘:</span> <input type="number" id="startCash" oninput="updateCalculations()"></label>
  </div>

 <table class="outer-table" style="width: 100%; border: 2px solid #333; border-collapse: collapse; margin-bottom: 20px;">
  <tr>
    <td style="padding: 10px;">

      <div class="group" id="salesGroup">
        <label><span>ç¾é‡‘å£²ä¸Š:</span> <input type="text" id="cashSales" disabled></label>
        <label><span>ã‚«ãƒ¼ãƒ‰å£²ä¸Š:</span> <input type="text" id="cardSales" disabled></label>
        <label><span>å£²ä¸Šåˆè¨ˆ:</span> <input type="text" id="totalSales" disabled></label>
      </div>

      <div class="group" id="laborGroup">
        <label><span>å¥³å­çµ¦ä¸:</span> <input type="text" id="femaleSalary" disabled></label>
        <label><span>ç”·å­çµ¦ä¸:</span> <input type="number" id="maleSalary" oninput="updateCalculations()"></label>
        <label><span>ã‚­ãƒ£ãƒƒãƒãƒãƒƒã‚¯:</span> <input type="text" id="catchBack" disabled></label>
        <label><span>ã‚¹ã‚«ã‚¦ãƒˆãƒãƒƒã‚¯:</span> <input type="number" id="scoutBack" oninput="updateCalculations()"></label>
        <label><span>é¡§å•æ–™:</span> <input type="text" id="adviserFee" disabled></label>
        <label><span>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ä»£:</span> <input type="number" id="driverFee" oninput="updateCalculations()"></label>
        <label><span>äººä»¶è²»åˆè¨ˆ:</span> <input type="text" id="totalLaborCosts" disabled></label>
      </div>

      <div class="group" id="taxGroup">
        <label><span>å¥³å­æºæ³‰è²»:</span> <input type="text" id="femaleTax" disabled></label>
        <label><span>ç”·å­æºæ³‰è²»:</span> <input type="number" id="maleTax" oninput="updateCalculations()"></label>
        <label><span>æºæ³‰è²»åˆè¨ˆ:</span> <input type="text" id="totalTax" disabled></label>
      </div>

      <div class="group" id="expensesGroup">
        <label><span>é…’ä»£:</span> <input type="number" id="alcohol" oninput="updateCalculations()"></label>
        <label><span>é ˜åæ›¸â‘ :</span> <input type="number" id="receipt1" oninput="updateCalculations()"></label>
        <label><span>é ˜åæ›¸â‘¡:</span> <input type="number" id="receipt2" oninput="updateCalculations()"></label>
        <label><span>é ˜åæ›¸â‘¢:</span> <input type="number" id="receipt3" oninput="updateCalculations()"></label>
        <label><span>é ˜åæ›¸â‘£:</span> <input type="number" id="receipt4" oninput="updateCalculations()"></label>
        <label><span>é ˜åæ›¸â‘¤:</span> <input type="number" id="receipt5" oninput="updateCalculations()"></label>
        <label><span>é ˜åæ›¸åˆè¨ˆ:</span> <input type="text" id="receipt6" disabled></label>
        <label><span>çµŒè²»åˆè¨ˆ:</span> <input type="text" id="totalExpenses" disabled></label>
      </div>

      <div class="group" id="resultsGroup">
        <label><span>ç²—åˆ©ç›Š:</span> <input type="text" id="grossProfit" disabled></label>
        <label><span>ç¾é‡‘æ®‹:</span> <input type="text" id="remainingCash" disabled></label>
      </div>

    </td>
  </tr>
</table>

<table class="outer-table" style="width: 100%; border: 2px solid #333; border-collapse: collapse; margin-bottom: 20px;">
  <tr>
    <td style="padding: 10px; background-color: #3e3e5a;">

      <div class="group" id="extraGroup">
        <label><span>ç²—åˆ©ç›Š:</span> <input type="text" id="grossProfit_extra" disabled></label>
        <label><span>ã‚«ãƒ¼ãƒ‰å£²ä¸Š:</span> <input type="text" id="cardSales_extra" disabled></label>
        <label><span>ç¾é‡‘æ®‹:</span> <input type="text" id="remainingCash_extra" disabled></label>
        <label><span>æºæ³‰è²»åˆè¨ˆ:</span> <input type="text" id="totalWithholdingTax" disabled></label>

        <div style="height: 1em;"></div>

        <label><span>åˆè¨ˆï¼ˆç¾é‡‘æ®‹ + æºæ³‰è²»ï¼‰:</span> <input type="text" id="totalGrossPlusTax" disabled></label>
      </div>

    </td>
  </tr>
</table>

  <div class="group no-bg">
    <label><span>é›†è¨ˆæå‡ºå‰é‡‘åº«é‡‘:</span> <input type="number" id="finalCash" oninput="updateCalculations()"></label>
    <label><span>ç¾é‡‘èª¤å·®:</span> <input type="text" id="cashDifference" disabled></label>
  </div>

  <button class="reset-button" onclick="resetForm()">ãƒªã‚»ãƒƒãƒˆ</button>
  <button class="reset-button" onclick="resetAllData()">å®Œå…¨ãƒªã‚»ãƒƒãƒˆ</button>
  <div style="text-align: center; margin-top: 20px;">
  <button onclick="exportAsSelfContainedHTML()">å…¥åŠ›æ¸ˆã¿ã§HTMLä¿å­˜</button>
</div>

</div>







































<script>

//<base script---------------------------------------------------------------------------------------------------------------->
    const tabs = document.querySelectorAll('.tab');
  const contents = document.querySelectorAll('.content');

  // ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºåˆ‡æ›¿ã™ã‚‹å…±é€šé–¢æ•°
  function activateTab(target) {
    tabs.forEach(t => t.classList.remove('active'));
    contents.forEach(c => c.style.display = 'none');

    const tab = Array.from(tabs).find(t => t.getAttribute('data-target') === target);
    if (tab) tab.classList.add('active');

    const el = document.getElementById(target);
    if (el) el.style.display = 'block';
  }

  tabs.forEach(tab => {
    tab.addEventListener('click', (e) => {
      if (!e.currentTarget.classList.contains('tab')) {
        console.warn('ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ãŒ.tabã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å‡¦ç†ã‚’ä¸­æ­¢');
        return;
      }

      const target = tab.getAttribute('data-target');
      console.log('clicked tab:', tab);
      console.log('target:', target);

      if (!target) {
        console.warn('data-targetå±æ€§ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚', tab);
        return;
      }

      activateTab(target);

      // é¸æŠã‚¿ãƒ–IDã‚’localStorageã«ä¿å­˜
      localStorage.setItem('selectedTab', target);

      updateCalculations();
    });
  });

  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜ã•ã‚ŒãŸã‚¿ãƒ–ã‚’å¾©å…ƒã™ã‚‹å‡¦ç†
  window.addEventListener('DOMContentLoaded', () => {
    // æ—¢å­˜ã®å‡¦ç†
    observeTotalCountForAdviserFee();
    updateAdviserFeeFromTotalCount();

    // ä¿å­˜ã•ã‚ŒãŸã‚¿ãƒ–IDã‚’å–å¾—ã—ã¦å¾©å…ƒ
    const savedTab = localStorage.getItem('selectedTab');
    if (savedTab && document.getElementById(savedTab)) {
      activateTab(savedTab);
    } else {
      // ä¿å­˜ã•ã‚Œã¦ã„ãªã‘ã‚Œã°æœ€åˆã®ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
      const defaultTarget = tabs[0].getAttribute('data-target');
      activateTab(defaultTarget);
    }
  });

  function updateAdviserFeeFromTotalCount() {
    const countEl = document.getElementById('totalCount');
    const adviserFeeInput = document.getElementById('adviserFee');

    if (!countEl || !adviserFeeInput) return;

    const count = parseInt(countEl.textContent.replace(/,/g, ''), 10) || 0;
    const fee = count * 1000;
    adviserFeeInput.value = fee;

    updateCalculations(); // å¿…è¦ã«å¿œã˜ã¦å†è¨ˆç®—
  }

  function observeTotalCountForAdviserFee() {
    const target = document.getElementById('totalCount');
    if (!target) return;

    const observer = new MutationObserver(() => {
      updateAdviserFeeFromTotalCount();
    });

    observer.observe(target, {
      childList: true,
      characterData: true,
      subtree: true,
    });
  }

    let scrollPosition = 0;

    function showTab(tabId) {
      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
      scrollPosition = window.scrollY;

      // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’éè¡¨ç¤º
      const tabs = document.querySelectorAll('.tab-content');
      tabs.forEach(tab => tab.style.display = 'none');

      // é¸æŠã—ãŸã‚¿ãƒ–ã ã‘ã‚’è¡¨ç¤º
      const selectedTab = document.getElementById(tabId);
      if (selectedTab) selectedTab.style.display = 'block';

      // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å¾©å…ƒ
      window.scrollTo(0, scrollPosition);
    }







































//<app1 script---------------------------------------------------------------------------------------------------------------->
function saveCheckboxStates() {
  const checkboxes = document.querySelectorAll("table input[type='checkbox']");
  const states = Array.from(checkboxes).map(cb => cb.checked);
  localStorage.setItem("checkboxStates", JSON.stringify(states));
}

function restoreCheckboxStates() {
  const states = JSON.parse(localStorage.getItem("checkboxStates"));
  if (!states) return;
  const checkboxes = document.querySelectorAll("table input[type='checkbox']");
  checkboxes.forEach((cb, index) => {
    cb.checked = states[index];
  });
}

let rowNumber = 2;

window.addEventListener('load', function () {
  restoreForm();                // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
  restoreCheckboxStates();      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹çŠ¶æ…‹å¾©å…ƒ
  document.querySelectorAll("table input[type='checkbox']").forEach(cb => {
    cb.addEventListener("change", saveCheckboxStates);
  });

  filterCategory('all');        // â†ã™ã¹ã¦ã®è¡Œã‚’åˆæœŸè¡¨ç¤º
  currentCategory = 'all';      // â†currentCategoryã‚‚ã‚»ãƒƒãƒˆ
});


function addRow() {
  const table = document.getElementById("formRows");
  const newRow = table.rows[0].cloneNode(true);
  newRow.querySelectorAll("input").forEach(input => input.value = "");
  newRow.querySelector(".rowNumber").textContent = rowNumber++;
  newRow.className = "row";
  const select = newRow.querySelector(".c");
  select.value = "";
  updateRowColor(select);
  table.appendChild(newRow);

  // ã‚ªãƒ•ã‚»ãƒƒãƒˆé‡ï¼ˆã‚¿ãƒ–ã®é«˜ã•ãªã©ã«åˆã‚ã›ã¦èª¿æ•´ï¼‰
  const offset = 75; // ä¾‹: 60pxä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ãšã‚‰ã™

  // è¿½åŠ è¡Œã®ä½ç½®ã‚’å–å¾—ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  const rect = newRow.getBoundingClientRect();
  const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
  const targetY = rect.top + scrollTop - offset;

  window.scrollTo({ top: targetY, behavior: 'smooth' });

  saveForm();
}

document.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    const target = e.target;
    // å…¥åŠ›æ¬„ã‹ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã¿å¯¾è±¡
    if (target.matches('input, select')) {
      e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Enteré€ä¿¡ã‚’é˜²æ­¢

      const formElements = Array.from(document.querySelectorAll('#formRows input, #formRows select'));
      const index = formElements.indexOf(target);
      if (index > -1 && index < formElements.length - 1) {
        formElements[index + 1].focus();
      }
    }
  }
});

function updateRowColor(select) {
  const row = select.closest("tr");
  row.className = "row";
  if (select.value) {
    row.classList.add("category-" + select.value);
  }
  saveForm();
}

function updateTotals() {
  let totalCustomers = 0, cardTotal = 0, totalAmount = 0;
  const catchbackTotals = {};
  const categories = ["UK", "K", "AB", "LA", "PA", "BB", "MS", "GM", "B", "JOE", "KOSE", "HE", "PB", "X", "Z"];
  categories.forEach(cat => catchbackTotals[cat] = { amount: 0, count: 0 });

  document.querySelectorAll(".row").forEach(row => {
    const num = parseInt(row.querySelector(".num")?.value) || 0;
    const honshi = parseInt(row.querySelector(".honshi")?.value) || 0;
    const amount = parseInt(row.querySelector(".amount")?.value) || 0;
    const card = parseInt(row.querySelector(".card")?.value) || 0;
    const total = parseInt(row.querySelector(".total")?.value) || 0;
    const category = row.querySelector(".c")?.value;

    totalCustomers += num + honshi;
    cardTotal += card;
    totalAmount += total;

    if (category && catchbackTotals[category]) {
      const backAmount = (amount <= 5999) ? amount * num * 0.2 : amount * num * 0.3;
      if (category === "X") {
        catchbackTotals[category].amount += backAmount;
        catchbackTotals[category].count += num;
      } else if (category !== "Z") {
        catchbackTotals[category].amount += backAmount;
        catchbackTotals[category].count += num;
      }
    }
  });

  let totalCount = 0, totalBackAmount = 0;
  categories.forEach(cat => {
    if (cat !== "X") {
      totalCount += catchbackTotals[cat].count;
      totalBackAmount += catchbackTotals[cat].amount;
    } else {
      totalBackAmount += catchbackTotals[cat].amount;
    }

    document.getElementById(`${cat}count`).textContent = catchbackTotals[cat].count.toLocaleString();
    document.getElementById(`${cat}total`).textContent = Math.floor(catchbackTotals[cat].amount).toLocaleString();
  });

  document.getElementById("totalCustomers").textContent = totalCustomers.toLocaleString();
  document.getElementById("cardTotal").textContent = cardTotal.toLocaleString();
  document.getElementById("cashTotal").textContent = (totalAmount - cardTotal).toLocaleString();
  document.getElementById("totalAmount").textContent = totalAmount.toLocaleString();
  document.getElementById("totalCount").textContent = totalCount.toLocaleString();
  document.getElementById("totalBackAmount").textContent = Math.floor(totalBackAmount).toLocaleString();

  const cardSalesInput = document.getElementById("cardSales");
if (cardSalesInput) {
  cardSalesInput.value = cardTotal;
}

  // æ—¥è¨ˆè¨ˆç®—ã®inputã«å€¤ã‚’ã‚»ãƒƒãƒˆ
  const totalSalesInput = document.getElementById("totalSales");
  if (totalSalesInput) {
    totalSalesInput.value = totalAmount;
  }

  saveForm();
}

function saveForm() {
  const formData = [];
  document.querySelectorAll(".row").forEach((row, index) => {
    const rowNumber = parseInt(row.querySelector(".rowNumber")?.textContent) || index + 1;

    const rowData = {
      rowNumber: rowNumber,
      honshi: row.querySelector(".honshi")?.value || "",
      category: row.querySelector(".c")?.value || "",
      amount: row.querySelector(".amount")?.value || "",
      num: row.querySelector(".num")?.value || "",
      detail: row.querySelector(".detail")?.value || "",
      card: row.querySelector(".card")?.value || "",
      total: row.querySelector(".total")?.value || "",
      checkboxes: {}
    };

    const checkboxes = row.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
      rowData.checkboxes[checkbox.parentElement.textContent.trim()] = checkbox.checked;
    });

    formData.push(rowData);
  });

  localStorage.setItem("formData", JSON.stringify(formData));
}


function restoreForm() {
  const savedData = localStorage.getItem("formData");
  if (savedData) {
    const formData = JSON.parse(savedData);
    const table = document.getElementById("formRows");

    // æœ€åˆã®è¡Œã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦å–å¾—
    const templateRow = table.rows[0];

    // æœ€åˆã®è¡Œä»¥å¤–ã‚’å‰Šé™¤
    while (table.rows.length > 1) {
      table.deleteRow(1);
    }

    formData.forEach((data, index) => {
      let row;
      if (index === 0) {
        row = table.rows[0];
      } else {
        row = templateRow.cloneNode(true);
        table.appendChild(row);
      }

      // å„ã‚»ãƒ«ã®å€¤ã‚’å¾©å…ƒ
      row.querySelector(".rowNumber").textContent = data.rowNumber || index + 1;
      row.querySelector(".honshi").value = data.honshi || "";
      row.querySelector(".c").value = data.category || "";
      row.querySelector(".amount").value = data.amount || "";
      row.querySelector(".num").value = data.num || "";
      row.querySelector(".detail").value = data.detail || "";
      row.querySelector(".card").value = data.card || "";
      row.querySelector(".total").value = data.total || "";

      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¾©å…ƒ
      const checkboxes = row.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(checkbox => {
        const labelText = checkbox.parentElement.textContent.trim();
        checkbox.checked = data.checkboxes && data.checkboxes[labelText] ? true : false;
      });

      // è¡Œã®è‰²ã‚’æ›´æ–°
      updateRowColor(row.querySelector(".c"));
    });

    updateTotals();
  }
}

function resetAll() {

  if (!confirm("æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
    return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‚‰å‡¦ç†ä¸­æ–­
  }
  
  // formRows ã®ä¸­ã®ã™ã¹ã¦ã®è¡Œã‚’å–å¾—
  const formRows = document.getElementById("formRows");
  const rows = formRows.querySelectorAll(".row");

  // æœ€åˆã®1è¡Œã‚’æ®‹ã—ã¦å‰Šé™¤
  for (let i = rows.length - 1; i >= 1; i--) {
    formRows.removeChild(rows[i]);
  }

  // æœ€åˆã®è¡Œã® input ã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆ
  const inputs = formRows.querySelectorAll("tr:first-child input, tr:first-child select");
  inputs.forEach(input => {
    if (input.type === "checkbox" || input.type === "radio") {
      input.checked = false;
    } else {
      input.value = "";
    }
  });

  // ã‚«ãƒ†ã‚´ãƒªåˆ¥é›†è¨ˆãªã©ã‚’ãƒªã‚»ãƒƒãƒˆ
  const countIds = [
    "UK", "K", "AB", "LA", "PA", "BB", "MS", "GM",
    "B", "JOE", "TR", "HE", "PB", "X", "Z"
  ];
  countIds.forEach(id => {
    document.getElementById(id + "count").textContent = "0";
    document.getElementById(id + "total").textContent = "0";
  });

  // åˆè¨ˆè¡¨ç¤ºã®ãƒªã‚»ãƒƒãƒˆ
  document.getElementById("totalCustomers").textContent = "0";
  document.getElementById("cashTotal").textContent = "0";
  document.getElementById("cardTotal").textContent = "0";
  document.getElementById("totalAmount").textContent = "0";
  document.getElementById("totalCount").textContent = "0";
  document.getElementById("totalBackAmount").textContent = "0";

  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚‚ãƒªã‚»ãƒƒãƒˆ
  document.querySelectorAll("table input[type='checkbox']").forEach(cb => {
    cb.checked = false;
  });
  localStorage.removeItem("checkboxStates");

  // è¡Œç•ªå·ã‚’ãƒªã‚»ãƒƒãƒˆ
  rowNumber = 2;

  window.scrollTo({ top: 0, behavior: "smooth" })
}

  let currentCategory = 'all';

  function updateRowColor(select) {
    const row = select.closest('tr');
    const value = select.value;
    
    // ã‚¯ãƒ©ã‚¹å†è¨­å®šï¼ˆèƒŒæ™¯è‰²ç”¨ï¼‰
    row.className = 'row';
    if (value) {
      row.classList.add('category-' + value);
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ä¸€è‡´ã—ã¦ã„ã‚Œã°è¡¨ç¤º
    row.style.display = (currentCategory === 'all' || value === currentCategory) ? '' : 'none';
  }

  document.addEventListener('DOMContentLoaded', () => {
    const selects = document.querySelectorAll('#formRows select.c');

    selects.forEach(select => {
      updateRowColor(select);
      select.addEventListener('change', () => {
        updateRowColor(select);
      });
    });

    filterCategory(currentCategory); // åˆæœŸè¡¨ç¤º
  });

    currentCategory = "filter";

  function updateRowColor(select) {
    const row = select.closest('tr');
    const value = select.value;
    
    // ã‚¯ãƒ©ã‚¹å†è¨­å®šï¼ˆèƒŒæ™¯è‰²ç”¨ï¼‰
    row.className = 'row';
    if (value) {
      row.classList.add('category-' + value);
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ä¸€è‡´ã—ã¦ã„ã‚Œã°è¡¨ç¤º
    row.style.display = (currentCategory === 'all' || value === currentCategory) ? '' : 'none';
  }

  document.addEventListener('DOMContentLoaded', () => {
    const selects = document.querySelectorAll('#formRows select.c');

    selects.forEach(select => {
      updateRowColor(select);
      select.addEventListener('change', () => {
        updateRowColor(select);
      });
    });

    filterCategory(currentCategory); // åˆæœŸè¡¨ç¤º
  });

  // â–¼ ã‚¿ãƒ–ã®åˆæœŸå¾©å…ƒ
  const savedTab = localStorage.getItem('selectedTab');
  const defaultTab = savedTab && document.getElementById(savedTab) ? savedTab : 'app1';
  activateTab(defaultTab);

function filterSlipsByCategory(category) {
  const rows = document.querySelectorAll('.slipRow');
  rows.forEach(row => {
    const rowCategory = row.getAttribute('data-category');
    row.style.display = (category === 'all' || category === rowCategory) ? '' : 'none';
  });
}

function filterCategory(category) {
  currentCategory = category;
  localStorage.setItem("selectedCategory", category); // â† ä¿å­˜

  const rows = document.querySelectorAll('#formRows tr');
  rows.forEach(row => {
    const select = row.querySelector('select.c');
    const value = select ? select.value : '';
    row.style.display = (category === 'all' || value === category) ? '' : 'none';
  });

  document.querySelectorAll('.tab button').forEach(btn => btn.classList.remove('active'));
  const activeBtn = Array.from(document.querySelectorAll('.tab button')).find(btn => {
    return btn.textContent === category || (category === 'all' && btn.textContent.includes('ã™ã¹ã¦è¡¨ç¤º'));
  });
  if (activeBtn) activeBtn.classList.add('active');
}


  restoreForm();
  restoreCheckboxStates();
  document.querySelectorAll("table input[type='checkbox']").forEach(cb => {
    cb.addEventListener("change", saveCheckboxStates);
  });

  // ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ã‚’å¾©å…ƒ
  const savedCategory = localStorage.getItem("selectedCategory") || "all";
  filterCategory(savedCategory);


function filterCardInputRows() {
  const rows = document.querySelectorAll('#formRows tr');
  rows.forEach(row => {
    const cardInput = row.querySelector('.card');
    const hasCardValue = cardInput && cardInput.value.trim() !== '';
    row.style.display = hasCardValue ? '' : 'none';
  });

  currentCategory = 'cardInputOnly'; // ç¾åœ¨ã®ã‚«ãƒ†ã‚´ãƒªã«ã‚»ãƒƒãƒˆï¼ˆä»»æ„ï¼‰
  document.querySelectorAll('.tab button').forEach(btn => btn.classList.remove('active'));
}

function filterCashOnlyRows() {
  const rows = document.querySelectorAll('#formRows tr');
  rows.forEach(row => {
    const cardInput = row.querySelector('.card');
    const cardValue = parseInt(cardInput?.value || "0");
    // cardãŒç©ºã¾ãŸã¯0ã®è¡Œã ã‘è¡¨ç¤º
    row.style.display = (!cardValue || cardValue === 0) ? '' : 'none';
  });

  currentCategory = 'cashOnly'; // ä»»æ„ã®è­˜åˆ¥ç”¨
  document.querySelectorAll('.tab button').forEach(btn => btn.classList.remove('active'));
}








































//<app2 script---------------------------------------------------------------------------------------------------------------->

function addBottleForm() {
  const container = document.getElementById('bottleFormsContainer');
  const newForm = createBottleForm(); // â†ç©ºã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¿½åŠ 
  container.appendChild(newForm);
  saveBottleForms(); // ä¿å­˜
}

function saveBottleForms() {
  const bottleForms = [];
  const forms = document.querySelectorAll('.bottle-form');

  forms.forEach(form => {
    const bottleDetails = form.querySelector('.bottleDetails').value || '';
    const bottleAmount = parseInt(form.querySelector('.bottleAmount').value) || 0;

    bottleForms.push({ bottleDetails, bottleAmount });
  });

  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒœãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
  localStorage.setItem('bottleForms', JSON.stringify(bottleForms));
}

function loadBottleForms() {
  const bottleFormsData = JSON.parse(localStorage.getItem('bottleForms')) || [];
  const container = document.getElementById('bottleFormsContainer');
  container.innerHTML = ''; // åˆæœŸåŒ–

  bottleFormsData.forEach(data => {
    const form = createBottleForm(data.bottleDetails, data.bottleAmount);
    container.appendChild(form);
  });
}

function renumberHistory() {
  const items = Array.from(document.querySelectorAll('#historyList li')).reverse(); // ä¸‹ã‹ã‚‰é †ã«1,2,3
  items.forEach((item, index) => {
    const castElem = item.querySelector('.castName');
    if (castElem) {
      let text = castElem.textContent.replace(/^\s*\d+\.\s*/, ' '); // æ—§ç•ªå·ã‚’å‰Šé™¤
      const nameOnly = text.replace(/^\s*/, '').trim();
      castElem.innerHTML = `<strong></strong> ${index + 1}. ${nameOnly}`;
    }
  });
}

function calculate() {
  // ã€Œä½“é¨“åŠã³è²¸å‡ºã€ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’å–å¾—
  const isExperienceAndRentalChecked = document.getElementById('experienceAndRental').checked;
  let experienceText = isExperienceAndRentalChecked ? 'ä½“é¨“åŠã³è²¸å‡º: æœ‰ã‚Š' : 'ä½“é¨“åŠã³è²¸å‡º: ç„¡ã—';

  const values = {
    f: 1500, f2: 2000, jounai: 1000, honshiri: 0, douhan: 1500,
    eda: 500, help: -1500, set40: 5500, set20: 3500, vip: 2000,
    a: 500, b: 1000, c: 1500, d: 2000, e: 2500
  };

  let total = 0;
  for (let key in values) {
    const count = parseInt(document.getElementById(key).value) || 0;
    total += count * values[key];
  }

   // å‹•çš„ã«è¿½åŠ ã•ã‚ŒãŸãƒœãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰é‡‘é¡ã¨è©³ç´°ã‚’å–å¾—
  const bottleForms = document.querySelectorAll('.bottle-form');
  bottleForms.forEach(form => {
    const bottleAmount = parseInt(form.querySelector('.bottleAmount').value) || 0;
    const bottleDetails = form.querySelector('.bottleDetails').value || 'è©³ç´°ãªã—';
    total += bottleAmount;
  });

  const kousei = 1000;
  const gensen = Math.ceil((total * 0.1) / 100) * 100;

  let afterGensen = total - gensen;

  let actualKousei = 0;

  // åšç”Ÿè²»ã®å¼•ãæ–¹ã‚’å¤‰æ›´
  if (!isExperienceAndRentalChecked) {
    if (afterGensen - kousei >= 5000) {
      actualKousei = kousei;
    } else {
      actualKousei = Math.max(0, afterGensen - 5000);
    }
  }

const kouseiStoreCovered = (actualKousei === 0) ? 1000 : 0;
const kouseiCastCovered = 0;

let welfareText = `åšç”Ÿè²»ï¼šÂ¥${actualKousei.toLocaleString()} (åº—èˆ—è² æ‹…ï¼šÂ¥${kouseiStoreCovered.toLocaleString()})`;

  // é€è¿é‡‘é¡ã®å–å¾—
  let sendoffAmount = parseInt(document.getElementById('sendoffAmount').value) || 0;

// åˆè¨ˆ = å°è¨ˆ - æºæ³‰è²» - åšç”Ÿè²»
let totalAmount = afterGensen - actualKousei;

let adjustedSendoff = 0;

if (!isExperienceAndRentalChecked) {
  adjustedSendoff = sendoffAmount;
  const tempFinalAmount = totalAmount - adjustedSendoff;

  if (tempFinalAmount < 5000) {
    const maxDeductible = totalAmount - 5000;
    adjustedSendoff = Math.max(0, maxDeductible);
  }
}

// æœ€çµ‚åˆè¨ˆ
let finalAmount = totalAmount - adjustedSendoff;

// åº—èˆ—è² æ‹…ãƒ»æœ¬äººè² æ‹…ã®è¨ˆç®—
const castCoveredAmount = adjustedSendoff;
const storeCoveredAmount = sendoffAmount - adjustedSendoff;

let sendoffText = `é€è¿ï¼šÂ¥${sendoffAmount.toLocaleString()} (æœ¬äººè² æ‹…ï¼šÂ¥${castCoveredAmount.toLocaleString()}`;
if (storeCoveredAmount > 0) {
  sendoffText += ` åº—èˆ—è² æ‹…ï¼šÂ¥${storeCoveredAmount.toLocaleString()})`;
} else {
  sendoffText += `)`; // â†ã“ã‚Œã‚’è¿½åŠ ã™ã‚‹ã¨å®‰å¿ƒ
}

  const labels = {
    f: 'F',
    f2: 'F2',
    jounai: 'å ´å†…',
    honshiri: 'æœ¬æŒ‡',
    douhan: 'åŒä¼´',
    eda: 'æ',
    help: 'HELP',
    set40: 'SET40',
    set20: 'SET20',
    vip: 'VIP',
    a: 'A',
    b: 'B',
    c: 'C',
    d: 'D',
    e: 'E'
  };

  let detailsHTML = '<div class="details" style="font-size: 14px; margin-top: 10px;">';
 
  for (let key in values) {
    const count = parseInt(document.getElementById(key).value) || 0;
    if (count > 0) {
      const label = labels[key] || key.toUpperCase();
      const unitPrice = values[key];
      const subtotal = count * unitPrice;
      detailsHTML += `<div>${label} Ã—${count}ï¼ˆÂ¥${unitPrice.toLocaleString()}ï¼‰= Â¥${subtotal.toLocaleString()}</div>`;
    }
  }

// è¿½åŠ ã•ã‚ŒãŸå…¨ãƒœãƒˆãƒ«æ˜ç´°
bottleForms.forEach(form => {
  const bottleAmount = parseInt(form.querySelector('.bottleAmount').value) || 0;
  const bottleDetail = form.querySelector('.bottleDetails').value || 'è©³ç´°ãªã—';
  if (bottleAmount > 0) {
    detailsHTML += `<div>ãƒœãƒˆãƒ«: Â¥${bottleAmount.toLocaleString()}ï¼ˆ${bottleDetail}ï¼‰</div>`;
  }
});

detailsHTML += '</div>';

  const castName = document.getElementById('castName').value || 'ï¼ˆåå‰ãªã—ï¼‰';

const resultText = `
  <span class="castName"><strong></strong> ${castName}</span>
  <span class="experienceAndRental">${experienceText}</span>
  <span class="subtotal"><strong>å°è¨ˆ:</strong> Â¥${total.toLocaleString()}</span>
  <span class="tax" style="font-size: 16px; font-weight: bold;">
  <strong>æºæ³‰è²»:</strong> Â¥${gensen.toLocaleString()}
  </span>
  <span class="welfare" style="font-size: 16px; font-weight: bold;">
  <span class="welfare" style="font-size: 16px; font-weight: bold;"><strong>${welfareText}</strong></span>
  </span>
  <span class="totalAmount" style="font-size: 25px; font-weight: bold;">
  <strong>åˆè¨ˆ:</strong> Â¥${totalAmount.toLocaleString()}<span class="print-only" style="float: right; font-size: 14px; margin-left: 10px;">â†é ˜åæ›¸è¨˜å…¥</span>
  </span>
  </span>
  <span class="sendoff"><strong>${sendoffText}</strong></span>
  <span class="finalAmount print-highlight"><strong>æœ€çµ‚åˆè¨ˆ:</strong> Â¥${finalAmount.toLocaleString()}</span>
  ${detailsHTML}
`;

  // å±¥æ­´ã«æ–°ã—ã„é …ç›®ã‚’è¿½åŠ 
const existingItem = Array.from(historyList.children).find(item => {
  const nameElem = item.querySelector('.castName');
  if (!nameElem) return false;

  // ğŸ”½ æ­£è¦è¡¨ç¾ã§å…ˆé ­ã®ç•ªå·ï¼ˆä¾‹: "1. "ï¼‰ã‚’å‰Šé™¤
  const nameText = nameElem.textContent.replace(/^\s*\d+\.\s*/, '').trim();
  
  return nameText === castName;
});


// detailsHTMLã‚’å›²ã‚“ã§éè¡¨ç¤ºã«ã™ã‚‹
const detailsHiddenHTML = `<div class="details-html-container" style="display:none; font-size:14px; margin-top:5px;">${detailsHTML}</div>`;

const fullHTML = `
  <div>
    <label><input type="checkbox" class="history-checkbox"> å‰Šé™¤å¯¾è±¡</label>
    ${resultText.replace(detailsHTML, '')}
    ${detailsHiddenHTML}
    <div style="margin-top: 5px;">
      <button onclick="restoreFromHistory(this)" style="margin-right: 5px; font-size: 12px;">å¾©å…ƒ</button>
      <button onclick="moveHistoryItem(this, 'up')" style="font-size: 12px;">â†‘</button>
      <button onclick="moveHistoryItem(this, 'down')" style="font-size: 12px;">â†“</button>
    </div>
  </div>
`;

if (existingItem) {
  existingItem.innerHTML = fullHTML;
} else {
  const listItem = document.createElement('li');
  listItem.innerHTML = fullHTML;
  historyList.prepend(listItem);
}

  renumberHistory();

  // ã‚µãƒãƒªãƒ¼ã‚’æ›´æ–°
  updateSummary();


  // ä¿å­˜å‡¦ç†
  const inputElements = document.querySelectorAll('input[type="number"], input[type="text"]');
  const inputValues = {};
  inputElements.forEach(input => {
    inputValues[input.id] = input.value;
  });
  localStorage.setItem('inputs', JSON.stringify(inputValues));
  localStorage.setItem('historyList', historyList.innerHTML);
  localStorage.setItem('result', resultText);

  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚‚ä¿å­˜
  const checkboxStates = {
  experienceAndRental: document.getElementById('experienceAndRental').checked
   };
  localStorage.setItem('checkboxes', JSON.stringify(checkboxStates));

    // ğŸ”½ ã“ã“ã‚’è¿½åŠ ï¼šãƒœãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒ ã®å†…å®¹ã‚‚ä¿å­˜ã™ã‚‹
  saveBottleForms();

  console.log('f:', inputValues['f']);
  console.log(inputValues); // å…¥åŠ›å€¤ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
  console.log('é€è¿é‡‘é¡:', sendoffAmount); // é€è¿é‡‘é¡ãŒå–å¾—ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª


  document.getElementById("result").innerHTML = resultText;
  document.getElementById("result").scrollIntoView({ behavior: "smooth", block: "start" });


}

function moveHistoryItem(button, direction) {
  const listItem = button.closest('li');
  if (!listItem) return;

  const parentList = listItem.parentNode;
  let targetItem = null;

  if (direction === 'up' && listItem.previousElementSibling) {
    targetItem = listItem.previousElementSibling;
    parentList.insertBefore(listItem, targetItem);
  } else if (direction === 'down' && listItem.nextElementSibling) {
    targetItem = listItem.nextElementSibling;
    parentList.insertBefore(targetItem, listItem);
  }

  // â†“ ç§»å‹•å¾Œã®è¦ç´ ã«å¼·åˆ¶ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆDOMåæ˜ å¾Œã«å®Ÿè¡Œï¼‰
  requestAnimationFrame(() => {
    listItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
  });

  renumberHistory(); // â† é€£ç•ªå†æŒ¯ã‚Š
  localStorage.setItem('historyList', parentList.innerHTML);
  updateSummary();
}


function restoreFromHistory(button) {
  const historyItem = button.closest('li') || button.closest('div');
  if (!historyItem) return;

  // ã‚­ãƒ£ã‚¹ãƒˆåã®å¾©å…ƒ
  const castNameElem = historyItem.querySelector('.castName');
  const castName = castNameElem ? castNameElem.textContent.replace(/^\s*\d+\.\s*/, '').trim() : '';
  document.getElementById('castName').value = castName;

  // ãƒ©ãƒ™ãƒ«å¯¾å¿œè¡¨ã‚’å®šç¾©ï¼ˆcalculateé–¢æ•°ã¨åŒã˜å†…å®¹ï¼‰
  const labels = {
    f: 'F',
    f2: 'F2',
    jounai: 'å ´å†…',
    honshiri: 'æœ¬æŒ‡',
    douhan: 'åŒä¼´',
    eda: 'æ',
    help: 'HELP',
    set40: 'SET40',
    set20: 'SET20',
    vip: 'VIP',
    a: 'A',
    b: 'B',
    c: 'C',
    d: 'D',
    e: 'E'
  };

  // æ•°å€¤å…¥åŠ›æ¬„ã‚’å¾©å…ƒ
  const inputIds = Object.keys(labels);
  inputIds.forEach(id => {
    const label = labels[id];
    const regex = new RegExp(`${label} Ã—(\\d+)`);
    const match = historyItem.textContent.match(regex);
    if (match) {
      document.getElementById(id).value = match[1];
    } else {
      document.getElementById(id).value = '';
    }
  });

  // é€è¿é‡‘é¡ã‚’å¾©å…ƒ
  const sendoffMatch = historyItem.textContent.match(/é€è¿ï¼šÂ¥([\d,]+)/);
  if (sendoffMatch) {
    document.getElementById('sendoffAmount').value = parseInt(sendoffMatch[1].replace(/,/g, ''), 10);
  } else {
    document.getElementById('sendoffAmount').value = 0;
  }

// ä½“é¨“åŠã³è²¸å‡ºãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å¾©å…ƒï¼ˆtextContentã‹innerHTMLã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚‹ã‹ç¢ºèªï¼‰
const experienceElem = historyItem.querySelector('.experienceAndRental');
const experienceText = experienceElem ? experienceElem.textContent : '';
const experienceChecked = experienceText.includes('ä½“é¨“åŠã³è²¸å‡º: æœ‰ã‚Š');
document.getElementById('experienceAndRental').checked = experienceChecked;

  // ãƒœãƒˆãƒ«æ˜ç´°ã‚’å¾©å…ƒ
  const bottleRegex = /ãƒœãƒˆãƒ«: Â¥([\d,]+)ï¼ˆ([^ï¼‰]+)ï¼‰/g;
  const bottles = [];
  let match;
  while ((match = bottleRegex.exec(historyItem.innerHTML)) !== null) {
    bottles.push({
      bottleAmount: parseInt(match[1].replace(/,/g, '')),
      bottleDetails: match[2]
    });
  }

  const container = document.getElementById('bottleFormsContainer');
  container.innerHTML = ''; // ä¸€åº¦ã‚¯ãƒªã‚¢
bottles.forEach(data => {
  const bottleForm = document.createElement('div');
  bottleForm.classList.add('bottle-form');
  bottleForm.innerHTML = `
    <label>
      <input type="text" class="bottleDetails" placeholder="ãƒœãƒˆãƒ«è©³ç´°" value="${data.bottleDetails}">
    </label>
    <label>
      <input type="number" class="bottleAmount" placeholder="ãƒœãƒˆãƒ«é‡‘é¡" min="0" value="${data.bottleAmount === 0 ? '' : data.bottleAmount}">
    </label>
  `;
  container.appendChild(bottleForm);
});

  // ä¿å­˜å‡¦ç†ï¼ˆç¾åœ¨ã®å¾©å…ƒçŠ¶æ…‹ã‚’ä¿å­˜ã—ã¦ãŠãï¼‰
  saveBottleForms();

    // ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  window.scrollTo({ top: 0, behavior: 'smooth' });

}

function deleteSelectedHistory() {
  const historyList = document.getElementById('historyList');
  const items = historyList.querySelectorAll('li');

  const checkedItems = Array.from(items).filter(item => {
    const checkbox = item.querySelector('.history-checkbox');
    return checkbox && checkbox.checked;
  });

  if (checkedItems.length === 0) {
    alert('å‰Šé™¤ã™ã‚‹å±¥æ­´ã‚’é¸æŠã—ã¦ãã ã•ã„');
    return;
  }

  const deletedNames = [];

  checkedItems.forEach(item => {
    const nameElem = item.querySelector('.castName');
    const name = nameElem ? nameElem.textContent.replace('', '').trim() : 'ä¸æ˜';

    const confirmed = confirm(`ã€Œ${name}ã€ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`);
    if (confirmed) {
      deletedNames.push(name);
      item.remove();
    }
  });

  // å‰Šé™¤å¾Œã®ä¿å­˜
  localStorage.setItem('historyList', historyList.innerHTML);
  updateSummary();

  // å‰Šé™¤çµæœã®è¡¨ç¤º
  if (deletedNames.length > 0) {
    const msg = deletedNames.map(name => `${name} ã®å±¥æ­´ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚`).join('\n');
    alert(msg);
  }
}

function updateSummary() {
  const historyItems = document.querySelectorAll('#historyList li');
  let totalPeople = 0;
  let totalAmount = 0;
  let totalGensen = 0;

  historyItems.forEach(item => {
    const text = item.innerText;

    const amountMatch = text.match(/åˆè¨ˆ:\s*Â¥([\d,]+)/);
    const gensenMatch = text.match(/æºæ³‰è²»:\s*Â¥([\d,]+)/);

    if (amountMatch) {
      const amount = parseInt(amountMatch[1].replace(/,/g, ''), 10);
      totalAmount += amount;
    }

    if (gensenMatch) {
      const gensen = parseInt(gensenMatch[1].replace(/,/g, ''), 10);
      totalGensen += gensen;
    }

    totalPeople += 1;
  });

  // å„ span ã«å€¤ã‚’åæ˜ 
  document.getElementById('summaryTotalPeople').innerText = `${totalPeople}äºº`;
  document.getElementById('summaryTotalAmount').innerText = `Â¥${totalAmount.toLocaleString()}`;
  document.getElementById('summaryTotalTax').innerText = `Â¥${totalGensen.toLocaleString()}`;

  document.getElementById('femaleSalary').value =
  totalAmount; // æ•°å€¤ã§ã‚»ãƒƒãƒˆ

  document.getElementById('femaleTax').value = totalGensen;

}

function toggleDetails(button) {
  const container = button.nextElementSibling.nextElementSibling; 
  // ãƒœã‚¿ãƒ³ã®ã™ãæ¬¡ã®ãƒœã‚¿ãƒ³ã®æ¬¡ã®divï¼ˆdetails-html-containerï¼‰ã‚’å–å¾—
  if (container.style.display === 'none' || container.style.display === '') {
    container.style.display = 'block';
    button.textContent = 'è©³ç´°ã‚’éš ã™';
  } else {
    container.style.display = 'none';
    button.textContent = 'è©³ç´°ã‚’è¡¨ç¤º';
  }
}

function calculateBack() {
  const values = {
    f: 1500,
    f2: 2000,
    jounai: 1000,
    honshiri: 0,
    douhan: 1500,
    eda: 500,
    help: -1500,
    set40: 5500,
    set20: 3500,
    vip: 2000,
    a: 500,
    b: 1000,
    c: 1500,
    d: 2000,
    e: 2500
  };

  const inputs = {
    f: document.getElementById("f"),
    f2: document.getElementById("f2"),
    jounai: document.getElementById("jounai"),
    honshiri: document.getElementById("honshiri"),
    douhan: document.getElementById("douhan"),
    eda: document.getElementById("eda"),
    help: document.getElementById("help"),
    set40: document.getElementById("set40"),
    set20: document.getElementById("set20"),
    vip: document.getElementById("vip"),
    a: document.getElementById("a"),
    b: document.getElementById("b"),
    c: document.getElementById("c"),
    d: document.getElementById("d"),
    e: document.getElementById("e")
  };

  let total = 0;
  let detailLines = [];

  Object.keys(values).forEach(key => {
    const count = parseInt(inputs[key]?.value || 0);
    if (count > 0) {
      const unitPrice = values[key];
      const itemTotal = count * unitPrice;
      total += itemTotal;

      const sign = unitPrice < 0 ? "-" : "";
      detailLines.push(`${key.toUpperCase()} Ã—${count}ï¼ˆÂ¥${Math.abs(unitPrice).toLocaleString()}ï¼‰= ${sign}Â¥${Math.abs(itemTotal).toLocaleString()}`);
    }
  });

  document.getElementById("total").textContent = "Â¥" + total.toLocaleString();
  document.getElementById("detail").value = detailLines.join("\n");
}

function printResult() {
  const printContents = document.getElementById('result').innerHTML; // è¨ˆç®—çµæœã‚’å–å¾—
  const originalContents = document.body.innerHTML; // å…ƒã®ãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚’ä¿å­˜

  document.body.innerHTML = printContents; // å°åˆ·ç”¨ã«çµæœã ã‘è¡¨ç¤º

  window.print(); // å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã

  document.body.innerHTML = originalContents; // å…ƒã®ãƒšãƒ¼ã‚¸å†…å®¹ã«æˆ»ã™
}

function preparePrint() {

    calculate();
    
      // ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
    const scrollX = window.scrollX || window.pageXOffset;
    const scrollY = window.scrollY || window.pageYOffset;
    const rows = document.querySelectorAll('.denpyou'); // å„ä¼ç¥¨ã®è¦ªdivãªã©ã«åˆã‚ã›ã¦é©åˆ‡ã«å¤‰æ›´

    rows.forEach(row => {
      const inputs = row.querySelectorAll('input, select, textarea');
      let hasValue = false;

      inputs.forEach(input => {
        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¾ãŸã¯ãã®ä»–ã®å…¥åŠ›
        if ((input.type === 'checkbox' && input.checked) || 
            (input.type !== 'checkbox' && input.value.trim() !== '')) {
          hasValue = true;
        }
         // å°åˆ·å¾Œã€å…ƒã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã«æˆ»ã™
         setTimeout(() => {
         window.scrollTo(scrollX, scrollY);
         }, 100);
      });
    

      // ä¾‹ãˆã°ã€hasValueãŒtrueã®å ´åˆã«ä½•ã‹å‡¦ç†ã™ã‚‹ãªã‚‰ã“ã“ã«è¨˜è¿°
      if (hasValue) {
        // ã“ã“ã«è¡Œã„ãŸã„å‡¦ç†ã‚’æ›¸ã
        console.log('å€¤ãŒã‚ã‚‹ä¼ç¥¨:', row);
      }
    });

    window.print();
}


    // å°åˆ·ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ.hide-for-printã‚’éè¡¨ç¤ºã«ï¼‰
    const style = document.createElement('style');
    style.innerHTML = `
      @media print {
        .hide-for-print {
          display: none !important;
        }
      }
    `;
    document.head.appendChild(style);

    setTimeout(() => {
      document.querySelectorAll('.hide-for-print').forEach(row => {
        row.classList.remove('hide-for-print');
      });
      document.head.removeChild(style);
    }, 1000);

function clearInputs() {
  const activeTab = document.querySelector('.tab.active');
  if (!activeTab) return;

  const targetId = activeTab.getAttribute('data-target');
  const targetContent = document.getElementById(targetId);
  if (!targetContent) return;

  // ãƒ†ã‚­ã‚¹ãƒˆãƒ»æ•°å€¤å…¥åŠ›ã®ã‚¯ãƒªã‚¢ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–å†…ã ã‘ï¼‰
  targetContent.querySelectorAll('input[type="number"], input[type="text"]').forEach(input => {
    input.value = '';
  });

  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆidãŒå›ºå®šãªã‚‰æ³¨æ„ï¼‰â†’ å¯¾è±¡ã‚¿ãƒ–å†…ã«é™å®š
  const checkbox = targetContent.querySelector('#experienceAndRental');
  if (checkbox) {
    checkbox.checked = false;
  }

  // ãƒœãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒ å‰Šé™¤ï¼ˆcontainerã®IDãŒå›ºå®šãªã‚‰æ³¨æ„ï¼‰
  const bottleFormsContainer = targetContent.querySelector('#bottleFormsContainer');
  if (bottleFormsContainer) {
    bottleFormsContainer.innerHTML = '';
  }

  // å¯¾è±¡ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆã‚¿ãƒ–åˆ¥ã‚­ãƒ¼å‰æï¼‰
  if (targetId === 'app1') {
    localStorage.removeItem('inputs');
    localStorage.removeItem('result');
  } else if (targetId === 'app2') {
    localStorage.removeItem('inputs2');
    localStorage.removeItem('result2');
    localStorage.removeItem('bottleForms');
  } else if (targetId === 'app3') {
    localStorage.removeItem('app3_inputs');
    localStorage.removeItem('app3_result');
  }

  // çµæœæ¬„ã‚¯ãƒªã‚¢ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–å†…ã®ã¿ï¼‰
  const result = targetContent.querySelector('#result');
  if (result) {
    result.innerHTML = '';
  }

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯å…¨ä½“ã§OK
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function clearAll() {
  const confirmClear = confirm("æœ¬å½“ã«ã™ã¹ã¦ã‚’å®Œå…¨ã«ã‚¯ãƒªã‚¢ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚");
  if (!confirmClear) return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆã€å‡¦ç†ã‚’ä¸­æ–­

  clearInputs(); // å…¥åŠ›æ¬„ã‚„ãƒœãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢

  // å±¥æ­´ã¨çµæœã‚’ã‚¯ãƒªã‚¢
  const historyList = document.getElementById('historyList');
  if (historyList) historyList.innerHTML = '';

  const result = document.getElementById('result');
  if (result) result.innerHTML = '';

  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯å¿…è¦ãªã‚­ãƒ¼ã ã‘å‰Šé™¤ï¼ˆå…¨éƒ¨æ¶ˆã™ãªã‚‰ localStorage.clear()ï¼‰
  localStorage.removeItem('inputs');
  localStorage.removeItem('historyList');
  localStorage.removeItem('result');
  localStorage.removeItem('bottleForms');

  // ã‚µãƒãƒªãƒ¼æ›´æ–°
  updateSummary();

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ãƒˆãƒƒãƒ—ã«æˆ»ã™
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

document.addEventListener('DOMContentLoaded', function () {});


window.addEventListener('DOMContentLoaded', () => {
  loadBottleForms();
});

function restoreCheckboxes() {
  const checkboxStates = JSON.parse(localStorage.getItem('checkboxes')) || {};
  document.getElementById('experienceAndRental').checked = checkboxStates.experienceAndRental || false;
}

window.onload = function () {
  loadBottleForms();
  restoreCheckboxes(); // â† è¿½åŠ 
  // ä»–ã«ã‚‚ loadInputs() ãªã©ãŒã‚ã‚‹ãªã‚‰ãã“ã«ã‚‚
};

window.addEventListener('load', () => {
  // å…¥åŠ›å€¤ã®å¾©å…ƒ
  const inputs = JSON.parse(localStorage.getItem('inputs')) || {};
  Object.entries(inputs).forEach(([id, value]) => {
    const el = document.getElementById(id);
    if (el) el.value = value;
  });

  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¾©å…ƒ
  const checkboxes = JSON.parse(localStorage.getItem('checkboxes')) || {};
  Object.entries(checkboxes).forEach(([id, checked]) => {
    const el = document.getElementById(id);
    if (el) el.checked = checked;
  });

  // å±¥æ­´ãƒªã‚¹ãƒˆã®å¾©å…ƒ
  const historyListHTML = localStorage.getItem('historyList');
  if (historyListHTML) {
    document.getElementById('historyList').innerHTML = historyListHTML;
  }

  // ãƒœãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒ ã®å¾©å…ƒ
  loadBottleForms();

  // è¨ˆç®—çµæœã®å¾©å…ƒ
  const resultText = localStorage.getItem('result');
  if (resultText) {
    document.getElementById('result').innerHTML = resultText;
  }

  // ã‚µãƒãƒªãƒ¼ã‚‚æ›´æ–°ã—ã¦ãŠã
  updateSummary();
});


document.getElementById('experienceAndRental').addEventListener('change', function(event) {
  if (this.checked) {
    const confirmed = confirm('ã€Œä½“é¨“åŠã³è²¸å‡ºã€ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã‚Šã¾ã—ãŸã€‚');
    if (!confirmed) {
      this.checked = false; // ãƒã‚§ãƒƒã‚¯ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    }
  }
});

window.addEventListener('DOMContentLoaded', loadBottleForms);

function createBottleForm(bottleDetails = '', bottleAmount = 0) {
  const bottleForm = document.createElement('div');
  bottleForm.classList.add('bottle-form');
  bottleForm.innerHTML = `
    <label>
      <input type="text" class="bottleDetails" placeholder="ãƒœãƒˆãƒ«è©³ç´°" value="${bottleDetails}">
    </label>
    <label>
      <input type="number" class="bottleAmount" placeholder="ãƒœãƒˆãƒ«é‡‘é¡" min="0" value="${bottleAmount}">
    </label>
  `;
  return bottleForm;
}






































//<app3 script----------------------------------------------------------------------------------------------------------------->
    function formatNumber(num) {
    return num.toLocaleString('ja-JP');
    }

    function get(id) {
      return parseInt(document.getElementById(id).value.replace(/,/g, '')) || 0;
    }

  function updateCalculations() {
    const cardTotalText = document.getElementById('cardTotal')?.textContent || '0';
    const cardTotal = parseInt(cardTotalText.replace(/,/g, '')) || 0;

    const cardSalesInput = document.getElementById("cardSales");
    if (cardSalesInput) {
    cardSalesInput.value = cardTotal;
     }
    const summaryTaxText = document.getElementById('summaryTotalTax')?.innerText || 'Â¥0';
    const summaryTaxValue = parseInt(summaryTaxText.replace(/[Â¥,]/g, ''), 10) || 0;
    document.getElementById('femaleTax').value = summaryTaxValue;
  // totalBackAmount ã‚’ catchBack ã«åæ˜ 
  const totalBackAmountText = document.getElementById("totalBackAmount").textContent.replace(/,/g, "");
  const totalBackAmount = parseInt(totalBackAmountText) || 0;
  document.getElementById("catchBack").value = totalBackAmount;

  const total = get('totalSales');
  const card = get('cardSales');
  const cash = total - card;
  document.getElementById('cashSales').value = formatNumber(cash);

  const labor = get('femaleSalary') + get('maleSalary') + get('catchBack') + get('scoutBack') + get('adviserFee') + get('driverFee');
  document.getElementById('totalLaborCosts').value = formatNumber(labor);

  const tax = get('femaleTax') + get('maleTax');
  document.getElementById('totalTax').value = formatNumber(tax);
  const receiptTotal = get('receipt1') + get('receipt2') + get('receipt3') + get('receipt4') + get('receipt5');
  document.getElementById('receipt6').value = formatNumber(receiptTotal);

  const expenses = get('alcohol') + receiptTotal;
  document.getElementById('totalExpenses').value = formatNumber(expenses);

  const gross = total - labor - tax - expenses;
  document.getElementById('grossProfit').value = formatNumber(gross);

  const remaining = gross - card;
  document.getElementById('remainingCash').value = formatNumber(remaining);

  const startCash = get('startCash');
  const finalCash = get('finalCash');
  const difference = (finalCash - remaining - tax) - startCash;
  document.getElementById('cashDifference').value = formatNumber(difference);

  updateNegativeColor('grossProfit');
  updateNegativeColor('remainingCash');
  updateNegativeColor('cashDifference');

  updateExtraGroupFields();

  saveToLocal();
}

function updateExtraGroupFields() {
  // ãã‚Œãã‚Œã®å€¤ã‚’å–å¾—ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ•°ã¯ä»–ã‹ã‚‰æ¸¡ã—ã¦ãã ã•ã„ï¼‰
  let grossProfit = get('grossProfit');         // ç²—åˆ©ç›Š
  let cardSales = get('cardSales');             // ã‚«ãƒ¼ãƒ‰å£²ä¸Š
  let remainingCash = get('remainingCash');     // ç¾é‡‘æ®‹
  let totalTax = get('totalTax');               // æºæ³‰è²»åˆè¨ˆ

  // åˆè¨ˆè¨ˆç®—ï¼šç¾é‡‘æ®‹ + æºæ³‰è²»
  let totalGrossPlusTax = remainingCash + totalTax;

  // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’è¡¨ç¤ºï¼ˆå­˜åœ¨ç¢ºèªã—ãªãŒã‚‰å®‰å…¨ã«ä»£å…¥ï¼‰
  let el;

  el = document.getElementById('grossProfit_extra');
  if (el) el.value = formatNumber(grossProfit);

  el = document.getElementById('cardSales_extra');
  if (el) el.value = formatNumber(cardSales);

  el = document.getElementById('remainingCash_extra');
  if (el) el.value = formatNumber(remainingCash);

  el = document.getElementById('totalWithholdingTax');
  if (el) el.value = formatNumber(totalTax);

  el = document.getElementById('totalGrossPlusTax');
  if (el) el.value = formatNumber(totalGrossPlusTax);
}


    function updateNegativeColor(id) {
      const element = document.getElementById(id);
      const value = parseInt(element.value.replace(/,/g, '')) || 0;
      if (value < 0) {
        element.classList.add('negative');
      } else {
        element.classList.remove('negative');
      }
    }

function saveToLocal() {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => {
    // disabled çŠ¶æ…‹ã§ã‚‚ä¿å­˜
    localStorage.setItem(input.id, input.value);
  });
}

function loadFromLocal() {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => {
    const saved = localStorage.getItem(input.id);
    if (saved !== null) input.value = saved;
  });
}

    function resetForm() {
      if (!confirm("ã™ã¹ã¦ã®å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
      localStorage.clear();
      document.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
      updateCalculations();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadFromLocal();
      const inputs = Array.from(document.querySelectorAll('input[type="number"]'));
      inputs.forEach((input, index) => {
        input.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const next = inputs[index + 1];
            if (next) next.focus();
          }
        });
      });
    });

    function resetAllData() {
      if (!confirm("ã™ã¹ã¦ã®å…¥åŠ›ã‚’å®Œå…¨ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
      localStorage.clear();

  // 2. ã™ã¹ã¦ã®ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‚’åˆæœŸåŒ–ï¼ˆinput, select, textareaï¼‰
  const inputs = document.querySelectorAll('input, select, textarea');
  inputs.forEach(input => {
    if (input.type === 'checkbox' || input.type === 'radio') {
      input.checked = false;
    } else if (input.type === 'number' || input.type === 'text' || input.tagName === 'TEXTAREA') {
      input.value = '';
    }
  });

  // 3. è¨ˆç®—çµæœã‚„è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚‚åˆæœŸåŒ–ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
  const results = document.querySelectorAll('.result, .output, .total'); // ã‚ˆãã‚ã‚‹ã‚¯ãƒ©ã‚¹å
  results.forEach(el => el.textContent = '');

  // 4. ç”»é¢å†èª­ã¿è¾¼ã¿ã§å†åˆæœŸåŒ–
     location.reload();
     updateCalculations();

  alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸ');

  updateCalculations(); // èª­ã¿è¾¼ã¿å¾Œã«å†è¨ˆç®—

}

//æ¥­å‹™å†…å®¹ã‚’ä¿å­˜
window.addEventListener("DOMContentLoaded", () => {
  const today = new Date();
  const todayStr = today.toISOString().slice(0, 10); // "YYYY-MM-DD"

  if (!localStorage.getItem("workStartDate")) {
    localStorage.setItem("workStartDate", todayStr);
  }
});

function saveApp3Data() {
  const fields = [
    'startCash', 'maleSalary', 'scoutBack', 'driverFee', 'maleTax',
    'alcohol', 'receipt1', 'receipt2', 'receipt3', 'receipt4', 'receipt5', 'finalCash'
  ];
  const data = {};
  fields.forEach(id => {
    const el = document.getElementById(id);
    if (el) data[id] = el.value;
  });
  localStorage.setItem('app3_inputs', JSON.stringify(data));
}

function restoreApp3Data() {
  const saved = localStorage.getItem('app3_inputs');
  if (!saved) return;
  const data = JSON.parse(saved);
  Object.entries(data).forEach(([id, value]) => {
    const el = document.getElementById(id);
    if (el) el.value = value;
  });
  updateCalculations(); // è¨ˆç®—æ›´æ–°
}

function attachApp3Listeners() {
  const fields = [
    'startCash', 'maleSalary', 'scoutBack', 'driverFee', 'maleTax',
    'alcohol', 'receipt1', 'receipt2', 'receipt3', 'receipt4', 'receipt5', 'finalCash'
  ];
  fields.forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener('input', saveApp3Data);
    }
  });
}

window.addEventListener('DOMContentLoaded', () => {
  restoreApp3Data();
  attachApp3Listeners();
});

function exportAsSelfContainedHTML() {
  // ğŸ”½ å„ã‚¢ãƒ—ãƒªã®ä¿å­˜é–¢æ•°ã‚’äº‹å‰ã«å‘¼ã³å‡ºã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æœ€æ–°åŒ–
  if (typeof saveForm === 'function') saveForm();          // app1
  if (typeof saveBottleForms === 'function') saveBottleForms();  // app2
  if (typeof saveApp3Data === 'function') saveApp3Data();  // app3ï¼ˆæ‰‹å‹•å®Ÿè£…ï¼‰

  // ğŸ”½ æœ€æ–°ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’å–å¾—ã—ã¦HTMLã«åŸ‹ã‚è¾¼ã‚€
  const doc = document.documentElement.cloneNode(true);
  const localStorageData = JSON.stringify(localStorage);
  const savedDate = localStorage.getItem("workStartDate") || new Date().toISOString().slice(0, 10);
  const fileName = `IBASD_${savedDate}.html`;

  // ğŸ”½ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å†ç¾ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®åŸ‹ã‚è¾¼ã¿
  const storageScript = document.createElement("script");
  storageScript.textContent = `
    (function() {
      const savedData = ${localStorageData};
      for (let key in savedData) {
        localStorage.setItem(key, savedData[key]);
      }
    })();
  `;

  const head = doc.querySelector("head");
  if (head) head.appendChild(storageScript);

  const html = "<!DOCTYPE html>\n" + doc.outerHTML;
  const blob = new Blob([html], { type: "text/html" });
  const url = URL.createObjectURL(blob);

  // ğŸ”½ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹
  const a = document.createElement("a");
  a.href = url;
  a.download = fileName;
  a.click();
  URL.revokeObjectURL(url);

  // ğŸ”½ ä¿å­˜å¾Œã®å‡¦ç†ï¼ˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  if (confirm("ä¿å­˜ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\nãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
    localStorage.clear();
    alert("ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
  } else {
    alert("ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã¯ãã®ã¾ã¾æ®‹ã£ã¦ã„ã¾ã™ã€‚");
  }
}

</script>

</body>
</html>
